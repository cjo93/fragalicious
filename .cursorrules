```markdown
# DEFRAG: AI AGENT OPERATING PROTOCOLS
# VERSION: 1.0 | AUTHORITY: SPECS.MD & SOURCE OF TRUTH

## 1. THE PRIME DIRECTIVE (THE "NO METAPHOR" RULE)
You are the **Architect of Defrag**. You are building a **Structural Analysis Platform** and a **Diagnostics Utility**, NOT a therapy or wellness app.
- **FORBIDDEN TERMS:** "Healing," "Journey," "Vibes," "Soul," "Energy," "Support," "Soft," "Wellness," "Empowerment."
- **MANDATORY LEXICON:** "Mechanics," "Friction," "Latency," "Protocols," "Engine," "Architecture," "Velocity," "Signal," "Noise."
- **TONE:** "Divine Structuralism." Authoritative, compassionate, precise, and grounded in physics.
- **REFERENCE:**,

## 2. VISUAL ARCHITECTURE ("GLASS & STEEL")
The UI must feel like a tool, not a toy.
- **NO SHADOWS:** Depth is defined by borders and opacity, never `box-shadow`.
- **NO GRADIENTS:** Use solid hex codes. Background is **Void Black** (`#050505`).
- **BORDERS:** Use `border-white/10` for structure. Active states are `border-white/40`.
- **CORNER RADIUS:** Strict `rounded-none` or `rounded-sm`. No "friendly" `rounded-xl`.
- **TYPOGRAPHY:**
  - Headers: Inter or Bold Sans-Serif.
  - Data/Numbers: **MANDATORY** `font-variant-numeric: tabular-nums` (Tabular Figures). Numbers must not wiggle.
- **ANIMATION:** Instant snap or mechanical easing (`cubic-bezier(0.22, 1, 0.36, 1)`). No "bouncy" springs.
- **REFERENCE:**,

## 3. TECH STACK & PATTERNS
- **FRONTEND:** Next.js 14+ (App Router). Use Server Components by default.
- **STYLING:** Tailwind CSS. Mobile-First.
- **BACKEND:** Python Microservice for ALL planetary calculations (Swiss Ephemeris). Never calculate positions in JS.
- **DATABASE:** Supabase (PostgreSQL).
  - Use Recursive CTEs for family tree traversal.
  - Respect the `lineage_nodes` and `family_edges` schema.
- **REFERENCE:**,

## 4. DOMAIN LOGIC (STRICT ADHERENCE)
- **NOON-STABLE PROTOCOL:** If birth time is missing, default to Noon, mask the Moon/Ascendant, and flag data as "Partial." Never guess.
- **ANCESTRAL GLITCHES:** Identify recursive patterns (3+ generations). Label them as "Loops," not "Trauma."
- **CREDITS AS "CYCLES":**
  - Database Field: `credits_balance` (Integer).
  - UI Label: "CYCLES" or "COMPUTE CAPACITY."
  - Context: Users pay for "Compute Power" to run heavy friction reports.
- **MONETIZATION:**
  - Product A: "The Manual" (One-Time, ~$27, 10 Cycles).
  - Product B: "Defrag OS" (Subscription, recurring Cycles).
- **REFERENCE:**,

## 5. CRITICAL FILE STRUCTURE
Do not invent new patterns. Follow this map:
- `/core_logic`: Python algorithms (Ephemeris, Pattern Recognition).
- `/components/ui`: "Brutalist" reusable atoms.
- `/app/api`: Next.js Route Handlers (Pass-through to Python or Supabase).
- `/supabase`: SQL migrations and RLS policies.
- **REFERENCE:**,

## 6. SAFETY & SECURITY
- **DATA:** PII (Birth Data) is toxic waste. Process it, store the *mechanics* (Gate 42, Line 3), then encrypt or minimize the raw data where possible.
- **PAYMENTS:** Webhooks must verify Stripe signatures. Check `credits_balance` before running expensive Python jobs.

```

---

### **How to Use This:**

1. **Create the File:** Copy the code block above into a new file named `.cursorrules` (if using Cursor) or `instructions.md` (if using another AI IDE) in your project root.
2. **Context Loading:** Ensure your AI IDE has "indexed" or "read" the `DEFRAG-SOURCE-OF-TRUTH.md` and `SPECS.md` files. This file acts as a summary, but the AI needs the full docs for deep context.
3. **Prompting Strategy:** When you ask for a feature, reference the section.
* *Bad Prompt:* "Make a pricing page." 
* *Good Prompt:* "Generate the Pricing Component per Section 4 (Monetization) and Section 2 (Visual Architecture). Use the 'Cycles' terminology."

### **Why This Works:**

* **Enforced "No Metaphor":** By explicitly forbidding words like "Healing," you prevent the AI from defaulting to its training data, which is full of generic "wellness app" boilerplate.
* **Visual Consistency:** The "Tabular Nums" and "No Shadow" rules prevent the "drift" where the UI starts looking like a generic Bootstrap template.
* **Architectural Integrity:** It forces the AI to respect the Python/JS split, ensuring it doesn't try to write complex astrology math in TypeScript, which would fail.
<system-reminder>
Your operational mode has changed from plan to build.
You are no longer in read-only mode.
You are permitted to make file changes, run shell commands, and utilize your arsenal of tools as needed.
</system-reminder>
```
